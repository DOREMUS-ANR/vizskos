{"version":3,"sources":["app/initialize.js","app/js/application.js","app/js/models/concept.js","app/js/models/thesaurus.js","app/js/routers/router.js","app/js/views/app.js","app/js/views/concept.js","app/js/views/footer.js","app/js/views/header.js","app/js/views/home.js","app/js/views/nav.js","app/js/views/navCircle.js","app/js/views/navTree.js","app/js/views/selectNav.js","app/js/views/templates/concept.hbs","app/js/views/templates/footer.hbs","app/js/views/templates/header.hbs","app/js/views/templates/helpers.js","app/js/views/templates/home.hbs","app/js/views/templates/main.hbs","app/js/views/templates/selectNav.hbs","app/js/views/view.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CChKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CCXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CCXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CCXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CCXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;CCrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"public/javascripts/app.js","sourcesContent":["var application = require('./js/application');\n\ndocument.VizSKOS = application;\n\ndocument.addEventListener('DOMContentLoaded', function() {\n\n\t//create the app\n  //application.initialize();\n\n  //route the initial url\n  Backbone.history.start({ pushState: true });\n\n});\n","var Application = {\n\n  initialize: function initializeApplication(params) {\n\n  \tvar AppView = require('./views/app');\n  \tvar Router = require('./routers/router');\n  \tvar Thesaurus = require('./models/thesaurus');\n\n    //create the collection of concepts\n    this.collection = new Thesaurus({attributes : { thesauri: params.thesauri }});\n\n    //create the app view, with a reference to the collection and this application\n    this.appView = new AppView({ el: \"#\" + params.id, collection : this.collection, attributes : { application: this }});\n\n    //create the router, with a reference to the collection and this application\n    this.router = new Router({collection : this.collection, attributes : { application: this }});\n\n  },\n\n  //fonction to handle the different kinds of URLs\n  //note : backbone sends to the router only the part of the URL that comes after the domain\n  //ex 1\n  //the URL is \"http://www.mimo-db.eu/uri=http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  //the path is \"uri=http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  //ex 2\n  //the URL is \"http://localhost:3333/uri=http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  //the path is \"uri=http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  //ex 3\n  //the URL is \"http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  //the path is \"InstrumentsKeywords/3305\"\n  //ex 4\n  //the URL is \"http://localhost:3333/http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  //the path is \"http://www.mimo-db.eu/InstrumentsKeywords/3305\"\n  processUri : function processUriApplication(path){\n    //path = \"doremus/peuples/\" + path;\n    path = path;\n    //if the path is the same as the location (ex 1)\n    if(path.search(location.origin) !== -1){\n      //replace it with example 3, more user friendly\n      return path.replace(location.origin, \"\");\n    //else if the path is not the same as the location\n    }else {\n      //if the path does not contain uri=, add it\n      if(path.search(\"uri=http\") === -1){\n        return path.replace(\"http\", \"uri=http\");\n      //pass on the path\n      }else{\n        return path;\n      }\n    }\n  }\n};\n\nmodule.exports = Application;\n","module.exports = Backbone.Model.extend({\n\n  // Default\n  defaults: {\n    concept : true, language : 'fr'\n  },\n\n  initialize: function initializeConcept(){\n\n    //handlebars has trouble with properties containing @\n    //sets \"clean\" properties\n  \tthis.set('uri', this.attributes[\"@id\"]);\n    this.set('type', this.attributes[\"@type\"]);\n\n    //generates an id that can be used in classes attached to html elements (without http:// and /)\n    var urlParts = this.attributes[\"@id\"].split(\"/\").join(\"\");\n    this.set('id', urlParts.substring((urlParts.length -10), urlParts.length));\n\n    //conceptScheme (wether it's a top concept or not)\n    if(this.attributes[\"skos:inScheme\"]){\n      this.set('conceptScheme', this.attributes[\"skos:inScheme\"]);\n    }else if(this.attributes[\"skos:topConceptOf\"]){\n      this.set('conceptScheme', this.attributes[\"skos:topConceptOf\"]);\n    }\n    var scheme = this.collection.getActiveThesaurus();\n    this.set('conceptSchemeName', scheme.name);\n    this.set('conceptSchemeClass', scheme.class);\n\n    this.set('conceptDefinition', this.attributes[\"skos:definition\"]);\n\n    //prefered labels\n    if(this.attributes[\"skos:prefLabel\"]){\n      this.set('prefLabel', Array.isArray(this.attributes[\"skos:prefLabel\"])? _.sortBy(this.attributes[\"skos:prefLabel\"], this.sortByLanguage) : [this.attributes[\"skos:prefLabel\"]] );\n    }\n\n    //alternate labels\n    if(this.attributes[\"skos:altLabel\"]){\n      this.set('altLabel', Array.isArray(this.attributes[\"skos:altLabel\"]) ? _.sortBy(this.attributes[\"skos:altLabel\"], this.sortByLanguage) : [this.attributes[\"skos:altLabel\"]] );\n    }\n\n    //parent\n    if(this.attributes[\"skos:hasTopConcept\"]){\n      if(Array.isArray(this.attributes[\"skos:hasTopConcept\"])){\n        this.set('hasTopConcept', this.attributes[\"skos:hasTopConcept\"].map(function(elt){ return elt[\"@id\"];}));\n      }else{\n        this.set('hasTopConcept', this.attributes[\"skos:hasTopConcept\"][\"@id\"]);\n      }\n    }\n    //console.log(\"attributes\",this.attributes);\n    //children\n    if(this.attributes[\"skos:narrower\"]){\n      this.set('narrower', Array.isArray(this.attributes[\"skos:narrower\"])? this.attributes[\"skos:narrower\"] : [this.attributes[\"skos:narrower\"]]);\n    }\n\n    //matches\n    if(this.attributes[\"skos:exactMatch\"]){\n      this.set('exactMatch', Array.isArray(this.attributes[\"skos:exactMatch\"]) ? this.attributes[\"skos:exactMatch\"] : [this.attributes[\"skos:exactMatch\"]]);\n    }\n    if(this.attributes[\"skos:closeMatch\"] ){\n      this.set('closeMatch', Array.isArray(this.attributes[\"skos:closeMatch\"]) ? this.attributes[\"skos:closeMatch\"] : [this.attributes[\"skos:closeMatch\"]]);\n    }\n\n  },\n  //returns previous or next concept in the collection\n  getRelative: function getRelativeConcept(direction) {\n    return this.collection.at(this.collection.indexOf(this) + direction);\n  },\n  //sort by language (alphabetical order)\n  sortByLanguage : function sortByLanguageConcept(elt){\n    if(elt[\"@language\"]){\n      switch(elt[\"@language\"]){\n        case \"ca\" :\n          return 1;\n        case \"de\" :\n          return 2;\n        case \"en\" :\n          return 3;\n        case \"fr\" :\n          return 4;\n        case \"it\" :\n          return 5;\n        case \"nl\" :\n          return 6;\n        case \"sv\" :\n          return 7;\n      }\n    }\n    return 0;\n  }\n});\n","var jsonld = require('jsonld');\nvar concept = require('./concept');\nvar application = require('../application');\nmodule.exports = Backbone.Collection.extend({\n\n  //default properties\n  //Warning : they are reset when all concepts in the collection are reset,\n  //not when some are added or removed\n\n  model: concept,\n  loaded: false,\n  activeURI : null,\n  activeThesaurus : null,\n  thesaurusLoading : null,\n  comparator: 'rank',\n /*thesauri : [{id : 'http://www.mimo-db.eu/InstrumentsKeywords',\n    named_id: 'InstrumentsKeywords',\n    pattern : 'http://www.mimo-db.eu/InstrumentsKeywords',\n    endpoint : 'http://data.mimo-db.eu/sparql/describe?uri=',\n    data: 'http://www.mimo-db.eu/data/InstrumentsKeywords.json',\n    base: 'http://www.mimo-db.eu/',\n    name : 'MIMO Thesaurus'},\n    {id : 'http://www.mimo-db.eu/HornbostelAndSachs',\n    named_id: 'HornbostelAndSachs',\n    pattern : 'http://www.mimo-db.eu/HornbostelAndSachs',\n    endpoint : 'http://data.mimo-db.eu/sparql/describe?uri=',\n    data: 'http://www.mimo-db.eu/data/HornbostelAndSachs.json',\n    base: 'http://www.mimo-db.eu/',\n    name: 'Sachs & Hornbostel classification'}\n  ],\n  thesauri : [{id : 'http://pas-sages.org/doremus/peuples/',\n    named_id: 'Peuples',\n    pattern : 'http://data.bnf.fr/ark',\n    endpoint : '',\n    data: 'http://pas-sages.org/doremus/peuples/data/peuples.json',\n    base: 'http://pas-sages.org/doremus/peuples/',\n    name : 'Peuples preview extraction',\n    multiple_parents : true}\n  ],*//*\n  thesauri : [{id : 'http://pas-sages.org/doremus/iaml/',\n    named_id: 'iaml',\n    pattern : 'http://data.doremus.org/vocabulary/iaml/',\n    endpoint : '',\n    data: 'http://pas-sages.org/doremus/data/iaml.json',\n    base: 'http://data.doremus.org/vocabulary/',\n    name : 'Medium of Performance IAML'},\n    {id : 'http://pas-sages.org/doremus/derivation/',\n    named_id: 'derivation',\n    pattern : 'http://data.doremus.org/vocabulary/derivation/',\n    endpoint : '',\n    data: 'http://pas-sages.org/doremus/data/derivation.json',\n    base: 'http://data.doremus.org/vocabulary/',\n    name : 'Types de dérivation entre oeuvres'}\n  ],*/\n  viewTypes : [{id : 2, name : 'tree'},{ id : 1, name : 'circular tree'}],\n  conceptClosed : false,\n  context : {\n    \"skos\": \"http://www.w3.org/2004/02/skos/core#\",\n    \"skos:Concept\": {\"@type\": \"@id\"},\n    \"skos:inScheme\": {\"@type\": \"@id\"},\n    \"skos:narrower\": {\"@type\": \"@id\"},\n    \"skos:exactMatch\": {\"@type\": \"@id\"},\n    \"skos:broader\": {\"@type\": \"@id\"},\n    \"skos:closeMatch\": {\"@type\": \"@id\"},\n    \"skos:topConceptOf\": {\"@type\": \"@id\"}\n  },\n\n  initialize : function(models, options){\n    this.thesauri = options.thesauri;\n  },\n\n  //return the active concept\n  getActiveConcept : function getActiveConceptThesaurus(){\n    var theconcept = this.models.filter(function(element){\n      return element.attributes.uri === this.activeURI;\n    }.bind(this));\n    return theconcept[0] || null;\n  },\n\n  //return the active thesaurus\n  getActiveThesaurus : function getActiveThesaurus(){\n    var thesaurus = this.activeThesaurus || this.thesaurusLoading;\n    thesaurus.prefLabel = [thesaurus.name];\n    thesaurus.type =  \"skos:ConceptScheme\";\n    thesaurus.uri = thesaurus.id;\n    return thesaurus;\n  },\n\n  //get thesauri (and which one is selected)\n  getThesauri : function getThesauriThesaurus(){\n    var thesaurus = this.getActiveThesaurus();\n    this.thesauri.forEach(function (element, index) {\n      if(thesaurus && element.id === thesaurus.id) {\n        element.selected = true;\n      }else{\n        element.selected = false;\n      }\n    });\n    return this.thesauri;\n  },\n\n\n  //set selected thesaurus\n  setActiveThesaurus : function setActiveThesaurus(thesaurus){\n      this.activeThesaurus = thesaurus;\n  },\n  //get thesaurus with named id\n  getThesaurusWithNamedId : function getThesaurusWithNamedId(named_id){\n    return _.findWhere(this.thesauri, {'named_id' : named_id});\n  },\n\n  //set filter\n  setFilter : function setFilterThesaurus(keyword){\n    sessionStorage.setItem(\"filter\", keyword);\n  },\n  //get filter\n  getFilter : function getFilterThesaurus(){\n    return sessionStorage.getItem(\"filter\") || \"\";\n  },\n\n  //get available kinds of nav (and which one is selected)\n  getViewTypes : function getViewTypesThesaurus(){\n    var viewType = this.getViewType();\n    this.viewTypes.forEach(function (element, index) {\n      if(element.id === viewType) {\n        element.selected = true;\n      }else{\n        element.selected = false;\n      }\n    });\n    return this.viewTypes;\n  },\n\n  //set the kind of nav selected\n  setViewType : function setViewTypeThesaurus(type){\n    //console.log(\"viewType\", this.getViewType(), Number(sessionStorage.getItem(\"viewType\")), type, Number(sessionStorage.getItem(\"viewType\"))=== type );\n    var oldtype = this.getViewType();\n    sessionStorage.setItem(\"viewType\", type);\n    if( oldtype !== type){\n      this.trigger(\"viewTypeChanged\", this);\n    }\n\n  },\n\n  //get the kind of nav selected\n  getViewType : function getViewTypeThesaurus(){\n    var viewType = Number(sessionStorage.getItem(\"viewType\")) || 2;\n    return viewType;\n  },\n\n  //checks if a URI corresponds to any of the Thesauri available in settings\n  matchAnyThesaurus : function matchAnyThesaurus(uri){\n    for(var i = 0; i< this.thesauri.length; i++){\n      var thesaurus = this.thesauri[i];\n      if(this.matchPattern(thesaurus.pattern, uri)) return true;\n    }\n    return false;\n  },\n\n  findKeywordInElement : function findKeywordInElementThesaurus(keyword, elt){\n    if( typeof elt === \"string\" ){\n      keyword = new RegExp(keyword, 'i');\n      if(elt.search(keyword) !== -1) return true;\n    }else if (Array.isArray(elt)){\n      for(str in elt){\n        if(this.findKeywordInElement(keyword, str)) return true;\n      }\n    } else if(typeof elt === \"object\" ){\n      for(str in elt){\n        if(this.findKeywordInElement(keyword, str)) return true;\n      }\n    }\n    return false;\n  },\n\n  filter : function filterThesaurus(keyword){\n\n    this.models.map(function(element){\n      if(this.findKeywordInElement(keyword, element.attributes.prefLabel)\n        || this.findKeywordInElement(keyword, element.attributes.altLabel)\n        || this.findKeywordInElement(keyword, element.attributes[\"skos:definition\"])){\n        element.attributes.filtered = true;\n      }else{\n        element.attributes.filtered = false;\n      }\n      return element;\n    }.bind(this));\n    this.trigger(\"filterChanged\", this);\n  },\n\n  getFilteredNodes : function getFilteredNodes(){\n    return this.models.filter(function(element){\n      if(element.attributes.filtered) return true;\n    });\n  },\n\n\n  //checks if a URI matches a pattern\n  matchPattern : function matchPatternThesaurus(pattern, uri){\n     var myRegExp = new RegExp(\"^\" + pattern + \"([\\\\w\\\\/\\\\.]*)\", \"g\");\n     return (uri.match(myRegExp) !== null)? true: false;\n  },\n\n  //selected URI sent by the router\n  setActiveURI : function setActiveURIThesaurus(uri){\n\n    //if the URI is not complete (cf application.js, ex 3), adds domain\n    if(uri.search(\"http\") === -1) uri = location.origin + \"/\" + uri;\n\n    //the URI is a thesaurus (true) or a concept (false)\n    var isFullThesaurus;\n    //in both cases finds which thesaurus\n    var whichThesaurus = this.thesauri.filter(function(element){\n      var myRegExp = new RegExp(\"^\" + element.pattern + \"([\\\\w\\\\/\\\\.]*)\", \"g\");\n      if (element.id === uri) {\n        isFullThesaurus = true;\n        return element;\n      }else if(this.matchPattern(element.pattern, uri)){\n        return element;\n      }\n    }.bind(this));\n\n    if(whichThesaurus.length>0){\n      if(isFullThesaurus){\n        //is uri one of the thesauri ? load it !\n        this.activeURI = uri;\n        if(this.activeThesaurus === null || this.activeThesaurus.id !== whichThesaurus[0].id){\n\n\n          this.loadThesaurus(whichThesaurus[0].named_id);\n        }else{\n          this.trigger(\"conceptChanged\", this);\n        }\n      }else{\n        //else if URI is a concept, load it first (before loading full nav)\n        this.loadURI(uri, whichThesaurus[0]);\n      }\n    }else{\n\n      //if URI matches nothing, then load first thesaurus in the settings\n      this.loadThesaurus(this.thesauri[0].named_id);\n    }\n  },\n\n  //load a single URI\n  loadURI : function loadURIThesaurus(uri, thesaurus){\n    //if it is not already the current one\n    if(uri != this.activeURI){\n      this.activeURI = uri;\n      this.trigger(\"conceptChanged\", this);\n\n      if(this.activeThesaurus === null || this.activeThesaurus.id !== thesaurus.id){\n\n        this.thesaurusLoading = thesaurus;\n        this.trigger(\"conceptChanged\", this);\n        $.ajax({\n          'url': thesaurus.endpoint + uri,\n          'headers': {'Accept' : 'application/ld+json'},\n          'dataType': 'json',\n          'context': this\n        }).done(function(collection){\n          var collection = _.where(collection, {'@id': uri});\n          //compacts json-ld (to avoid deep objects that are complicated to handle and sort)\n          jsonld.compact(collection, this.context, function(err, compacted) {\n            //build the tree\n            this.prepareData([compacted]);\n            //inform listeners\n            this.trigger(\"conceptChanged\", this);\n            //load full thesaurus for nav\n            this.loadThesaurus(thesaurus.named_id);\n          }.bind(this));\n        }).fail(function(error){\n          //if loading uri fails, load full thesaurus\n          this.loadThesaurus(thesaurus.named_id);\n        });\n      }\n    }\n  },\n  //loads thesaurus\n  loadThesaurus : function loadThesaurus(named_id){\n    //callback once loaded\n    var thesaurus = this.getThesaurusWithNamedId(named_id);\n    this.thesaurusLoading = thesaurus;\n\n    var loadingCompleted  = function (collection){\n\n      //compacts json-ld (to avoid deep objects that are complicated to handle and sort)\n      jsonld.compact(collection, this.context, function(err, compacted) {\n        this.setActiveThesaurus(thesaurus);\n        //inform listeners\n        this.trigger(\"navChanged\", this);\n        //this.trigger(\"navLoaded\", this);\n        this.trigger(\"conceptChanged\", this);\n        //build the tree\n        this.prepareData(compacted[\"@graph\"]);\n        //loading completed\n        this.loaded = true;\n        this.thesaurusLoading = null;\n      }.bind(this));\n\n    }\n    this.loaded = false;\n\n    $.ajax({\n      'url': thesaurus.endpoint + thesaurus.id ,\n      'headers': {'Accept' : 'application/ld+json'},\n      'context': this,\n      'dataType': 'json',\n      'crossDomain' : true\n    })\n    .done(loadingCompleted)\n    .fail(function(error){\n      //console.log(\"essai n°3\", thesaurus.data)\n      $.ajax({\n        'url': thesaurus.data ,\n        'context': this,\n        'dataType': 'json',\n        'crossDomain' : true\n      }).done(loadingCompleted)\n      .fail(function(error){\n        //console.log(error);\n      })\n    });\n\n  },\n\n  //get name of a concept\n  getName : function getName (prefLabels){\n    if(!prefLabels) return \"\";\n    if(Array.isArray(prefLabels)){\n      var name = prefLabels.filter(function(prefLabel){\n        //return typeof prefLabel === \"string\";\n        return prefLabel[\"@language\"] === \"fr\";\n      });\n      if(Array.isArray(name) && name[0]){\n        name = name[0][\"@value\"];\n      }else if(prefLabels[0] && typeof prefLabels[0] === \"string\"){\n        name = prefLabels[0];\n      }else{\n        name = prefLabels[0][\"@value\"];\n      }\n    }else if(prefLabels[\"@value\"]){\n      var name = prefLabels[\"@value\"];\n    }else{\n      var name = prefLabels;\n    }\n    return name;\n  },\n\n  getNameWithUri : function getNameWithUriThesaurus(uri){\n    var themodel = this.models.filter(function (element){\n      return element.attributes[\"@id\"] === uri;\n    });\n    if(themodel[0]) return this.getName(themodel[0].attributes[\"skos:prefLabel\"]);\n    return uri;\n  },\n\n  //get children concepts of a concept\n  getChildren : function getChildren(node){\n\n    var that = this;\n    //var children = node.attributes[\"skos:narrower\"];\n    return this.models.filter(function (element){\n      return element.attributes[\"skos:broader\"] &&\n      (element.attributes[\"skos:broader\"] === node[\"@id\"] ||\n      element.attributes[\"skos:broader\"].includes(node[\"@id\"]));\n\n    }).map(function (childElement){\n      var name = that.getName(childElement.attributes[\"skos:prefLabel\"]);\n      var children = that.getChildren(childElement.attributes);\n      var result = { name : name,\n        uri : childElement.attributes[\"@id\"],\n        id : childElement.attributes[\"id\"],\n        filtered: childElement.attributes.filtered};\n      if(children.length > 0) {\n        result.children = children;\n        result.size = children.length;\n      }else{\n        result.size = 1;\n      }\n      return result;\n    }).sort(that.sortThesaurus);\n\n  },\n\n\n  toggleConcept : function toggleConceptThesaurus(visible){\n    if(visible){\n      if(visible === true){\n        this.conceptClosed = false;\n      }else{\n        this.conceptClosed = true;\n      }\n    }else{\n      this.conceptClosed = !this.conceptClosed;\n    }\n    this.trigger(\"conceptToggled\");\n\n  },\n\n  findRank : function findRankThesaurus (dataObj){\n    //gives a rank property to each concept according to its place in the tree\n    //to enable prev/next navigation\n    var that = this;\n    if(!dataObj) return false;\n    dataObj.forEach(function(elt){\n      //elt.rank = that.counter;\n      //console.log(elt);\n      var themodel = _.findWhere(that.models, {id : elt.id });\n      //console.log(themodel);\n      themodel.set('rank', that.counter);\n      that.counter ++;\n      if (elt.children) that.findRank(elt.children);\n\n    })\n\n  },\n\n  sortThesaurus : function sortThesaurus (a, b){\n\n    var nameA=a.name.toLowerCase(), nameB=b.name.toLowerCase();\n        //console.log(nameA, nameB);\n    return nameA.localeCompare(nameB);\n\n  },\n\n  //get parent concepts of a concept\n  getParent : function getParentThesaurus(node, data){\n\n    if(data.length === 1) return [];\n\n    var parent = [];\n\n    if(node && node[\"skos:broader\"] ){\n      var grandParent;\n      var elementParent = data.filter(function (elt){\n        return elt[\"@id\"] === node[\"skos:broader\"] ||\n        node[\"skos:broader\"].includes(elt[\"@id\"]);\n      });\n      if(this.activeThesaurus.multiple_parents === true){\n        parent = Array.isArray(node[\"skos:broader\"]) ? node[\"skos:broader\"] : [node[\"skos:broader\"]];\n      }else{\n        if(elementParent[0] && elementParent[0].parents){\n          grandParent = elementParent[0].parents;\n        }else {\n          grandParent =  this.getParent(elementParent, data);\n        }\n        if(grandParent.length>0){\n          parent = grandParent;\n        }\n        parent = parent.concat([node[\"skos:broader\"]]);\n      }\n    }\n    //console.log(parent);\n    return parent;\n\n  },\n  //once the data is loaded, prepares a tree for nav rendering\n  prepareData: function prepareDataThesaurus(data){\n    var that = this;\n\n    this.provData = data;\n    //add parent hierarchy\n    var data = data.map(function(element){\n      var parent = this.getParent(element, data);\n\n      if(parent && parent.length>0){\n        element.parents = parent;\n      }\n      return element;\n    }.bind(this));\n\n    if(this.models.length === 1){\n      this.add(data);\n    }else{\n      this.reset(data);\n    }\n\n    if(this.models.length>1){\n\n    //creates hierarchical tree for nav\n      var filteredTree = this.models.filter(function(element){\n        return element.attributes[\"skos:topConceptOf\"] !== undefined || that.getName(element.attributes[\"skos:prefLabel\"]).match(/^Ethnologie --/);\n      })\n      .map(function (element){\n        var children = that.getChildren(element.attributes);\n        var result = { name : that.getName(element.attributes[\"skos:prefLabel\"]),\n          uri : element.attributes[\"@id\"],\n          id : element.attributes[\"id\"]};\n        if(children.length > 0) {\n          result.children = children;\n          result.size = children.length;\n        }else{\n          result.size = 1;\n        }\n        return result;\n      });\n\n      var dataTree = this.getActiveThesaurus();\n      dataTree.children = filteredTree;\n\n\n      this.counter = 1;\n      // dataTree = this.sortThesaurus(dataTree, 1);\n\n      //orders the collection according to the tree\n      this.findRank(dataTree.children);\n      this.models = _.sortBy(this.models, function(elt){ return Number(elt.attributes.rank);});\n      //console.log(this.counter, this.models);\n\n      //console.log(dataTree);\n      this.conceptTree = dataTree;\n      this.trigger(\"dataChanged\");\n    }\n\n\n  }\n\n});\n","var application = require('../application');\nmodule.exports = Backbone.Router.extend({\n    routes:{\n      \"\" : \"defaultRoute\", /* showHome to use the Home template*/\n      \"about\" : \"showAbout\",\n      \"*other\"    : \"defaultRoute\"\n    },\n\n    showAbout: function showAbout( ) {\n      //console.log(\"On aimerait afficher les infos \");\n\n    },\n\n    showHome: function showHome( ) {\n      //\n      application.appView.setPage('home');\n      Backbone.history.checkUrl();\n    },\n\n    defaultRoute: function(other){\n      if(!other) other =\"\";\n      application.appView.setPage('thesaurus');\n      //if other is defined, remove \"uri=\" to get the URI\n      //other = other.replace(\"doremus/peuples/uri=\", \"\") ;\n      other = other.replace(\"uri=\", \"\") ;\n      //send the URI to the collection\n      application.collection.setActiveURI(other);\n      //update router\n      Backbone.history.checkUrl();\n\n    }\n\n});\n","var View = require('./view');\nvar ConceptView = require('./concept');\nvar FooterView = require('./footer');\nvar HeaderView = require('./header');\nvar HomeView = require('./home');\nvar NavView = require('./nav');\nvar SelectNavView = require('./selectNav');\n\nvar _ = require('underscore');\n\nmodule.exports = View.extend({\n\n\n    template : require('./templates/main.hbs'),\n    page: null,\n\n    //if page has changed, render again\n    setPage: function setPageApp(newPage) {\n      if(newPage !== this.page){\n      \tthis.page = newPage;\n      \t(this.$('article').length > 0) ? this.afterRender() : this.render();\n      }\n    },\n\n    //after rendering\n    afterRender: function afterRenderApp() {\n\n     \tif(this.page === 'home'){\n     \t\tthis.headerView = new HeaderView({collection : this.collection, el: this.$('header .logo')}).render();\n     \t\tthis.homeView = new HomeView({collection : this.collection, el: this.$('article')}).render();\n     \t\tthis.footerView = new FooterView({collection : this.collection, el: this.$('footer')}).render();\n     \t}else if(this.page === 'thesaurus'){\n      \tthis.headerView = new HeaderView({collection : this.collection, el: this.$('header .logo')}).render();\n      \tthis.conceptView = new ConceptView({collection : this.collection, el: this.$('article')});\n      \tthis.navView = new NavView({collection : this.collection, el: this.$('nav.nav')}).render();\n      \tthis.selectNavView = new SelectNavView({collection : this.collection, el: this.$('header .tools') }).render();\n\n      }\n    }\n});\n","var View = require('./view');\nvar application = require('../application');\nrequire('./templates/helpers.js');\n\nmodule.exports = View.extend({\n\n    events: {\n      'click .close': 'close',\n      'click .link': 'activateLink',\n      'click .next': 'next',\n      'click .prev': 'prev'\n    },\n\n    template : require('./templates/concept.hbs'),\n\n    //set up listeners\n    afterInit: function afterInitConcept(){\n      this.listenTo(this.collection, 'conceptChanged', this.render);\n      this.listenTo(this.collection, 'conceptToggled', this.conceptToggled);\n      this.listenTo(this.collection, 'dataChanged', this.render);\n    },\n    //get information to render the template\n    getRenderData: function getConceptRenderData(){\n      this.model = this.collection.getActiveConcept();\n      return this.model ? $.extend({ language :'en' }, this.model.attributes) : this.collection.getActiveThesaurus();\n    },\n    //close the concept section\n    close: function closeConcept(element) {\n      this.collection.toggleConcept();\n      element.preventDefault();\n    },\n    //show next concept\n    next: function nextConcept(element) {\n      var newmodel = this.model.getRelative(1);\n      application.router.navigate(application.processUri(newmodel.attributes[\"@id\"]), {trigger : true});\n      element.preventDefault();\n    },\n    //show previous concept\n    prev: function prevConcept(element) {\n      var newmodel = this.model.getRelative(-1);\n      application.router.navigate(application.processUri(newmodel.attributes[\"@id\"]), {trigger : true});\n      element.preventDefault();\n    },\n    //show / hide concept\n    conceptToggled: function conceptToggledConcept(element) {\n      if(this.collection.conceptClosed){\n        this.$el.addClass(\"closed\");\n      }else{\n        this.$el.removeClass(\"closed\");\n      }\n    },\n    // Open / reduce the concept section\n    activateLink: function activateLinkConcept(element) {\n      application.router.navigate(application.processUri($(element.currentTarget).attr(\"href\")), {trigger : true});\n      element.preventDefault();\n    }\n});\n","var View = require('./view');\n\nmodule.exports = View.extend({\n    template : require('./templates/footer.hbs'),\n    // The DOM events specific to a concept.\n    events: {\n      'change #selectNav': 'selectNav',\n    },\n    //\n    getRenderData: function getRenderDataFooter(){\n      return{\n      };\n    },\n    //\n});\n","var View = require('./view');\n\nmodule.exports = View.extend({\n    template : require('./templates/header.hbs'),\n    // The DOM events specific to a concept.\n    events: {\n      'change #selectNav': 'selectNav',\n    },\n    //\n    getRenderData: function getRenderDataHeader(){\n      return{\n      };\n    },\n    //\n});\n","var View = require('./view');\n\nmodule.exports = View.extend({\n    template : require('./templates/home.hbs'),\n\n    events: {\n      'mouseover .box': 'changeBackground',\n    },\n    //\n    getRenderData: function getRenderDataHome(){\n      return{};\n    },\n    //\n    changeBackground: function changeBackgroundHome(event){\n      this.$el.find(\".home\").css(\"backgroundImage\", $(event.currentTarget).find(\"a\").css(\"backgroundImage\"));\n    }\n});\n","var View = require('./view');\nvar NavCircle = require('./navCircle');\nvar NavTree = require('./navTree');\nmodule.exports = View.extend({\n\n    // set up listeners\n    afterInit: function afterInitNav(){\n     \n      this.listenTo(this.collection, 'viewTypeChanged', this.render);\n      \n\n    },\n    \n    // the nav does not render a handlebars template\n    // instead it instanciates a new object to deal with d3js\n    render: function renderNav() {\n      this.$el.empty();\n      if(this.collection.getViewType() === 1){\n        this.navView = new NavCircle({collection : this.collection}).preRender();\n      }else if(this.collection.getViewType() === 2){\n        this.navView = new NavTree({collection : this.collection}).preRender();\n      }\n\n    }\n\n});\n","var View = require('./view');\nvar application = require('../application');\nmodule.exports = View.extend({\n\n    // nav listens for changes in the collection.\n    afterInit: function afterInitNav(){\n  \n      this.listenTo(this.collection, 'conceptChanged', this.showSelectedNode);\n      this.listenTo(this.collection, 'dataChanged', this.dataChanged);  \n\n      $(window).on(\"resize\", this.resize.bind(this));\n      this.root = this.collection.conceptTree;\n    },\n\n    //initialize size variables\n    //and apply them to svg elements\n    setSize: function setSizeNav(){\n      this.height = $(window).height() ;\n      this.width = $(window).width() ;\n      this.whiteRadius = 120;\n      this.yRadius = (this.height - 40) / 2;\n      this.xRadius = this.yRadius;\n      this.rotate = 0;\n      this.x = d3.scale.linear().range([0, this.width]),\n      this.y = d3.scale.linear().range([0, this.height]);\n      this.duration = 750;\n      \n      this.cluster\n        .size([360, this.yRadius - this.whiteRadius]);\n\n      this.svg\n        .style(\"width\", this.width + \"px\")\n        .style(\"height\", this.height + \"px\");\n\n      this.vis\n        .attr(\"width\", this.width)\n        .attr(\"height\", this.height);\n    },\n\n    //\n    resize: function resizeNav() {\n      \n      this.setSize();\n      this.render(this.root);\n    },\n\n    //when new data are available\n    dataChanged: function dataChanged() {\n      //get them\n      this.root = this.collection.conceptTree;\n      //re-render\n      if(this.root){\n        this.root.x0 = this.height / 2;\n        this.root.y0 = 0;\n\n        this.preRender();\n      }\n    },\n\n    //preRender - called when the object is created (ie when the type of nav changes)\n    //or when new data are available\n    //(but when nav is opened/closed render function is called directly)\n    preRender: function preRenderNav() {      \n      //remove previous\n      $(\"nav.nav\").empty();\n      \n      //creates tree circular projection\n      this.cluster = d3.layout.tree()\n        .separation(function(a, b) { return (a.parent == b.parent ? 1 : 2) / a.depth; });\n      this.diagonal = d3.svg.diagonal.radial()\n        .projection( function(d) { return [d.y, d.x / 180 * Math.PI]; } );\n      \n      //main svg node  \n      this.svg = d3.select(\"#vizskos .nav\");\n      this.vis = this.svg.append(\"svg:svg\");\n      \n      //node containing all other\n      this.main = this.vis\n        .append(\"svg:g\")\n          .attr(\"class\", \"main \" + this.collection.getActiveThesaurus().named_id);\n\n      //partition view\n      this.partition = d3.layout.partition()\n        .value(function(d) { return d.size; });\n\n      //white circle (decorative)\n      this.arc = this.main.append(\"svg:path\")\n        .attr(\"class\", \"arc\");\n\n      //apply size to elements\n      this.setSize();\n      \n      //call render function\n      if(this.root) this.render(this.root);\n     \n    },\n\n    //render function\n    //source is this.root\n    render : function renderNav(source) {\n\n      if(source !== undefined){\n        \n        var nodes = this.cluster.nodes(this.collection.conceptTree);\n        var links = this.cluster.links(nodes);\n        var whiteRadius = this.whiteRadius;\n\n        this.main\n            .attr(\"transform\", \"translate(\" + (100 + this.xRadius ) + \",\" + (25 + this.yRadius) + \")\");\n\n        var node = this.main.selectAll(\"g.node\").data(nodes);\n        var link = this.main.selectAll(\"path.link\").data(links);\n        \n        this.arc.attr(\"d\", d3.svg.arc().innerRadius(this.yRadius - this.whiteRadius).outerRadius(this.yRadius).startAngle(0).endAngle(2 * Math.PI));\n\n        var linkEnter = link.enter()\n          .append(\"svg:path\")\n            .attr(\"class\", \"link\")\n            .attr(\"d\", this.diagonal);\n\n        var linkUpdate = link.transition()\n          .duration(this.duration)\n          .attr(\"d\", this.diagonal);\n         \n\n        var linkExit = link.exit().transition()\n          .duration(this.duration)\n          .attr(\"transform\", function(d,i) {return \"rotate(\" + (source.x - 90) + \")translate(\" + (source.y ) + \")\"; })\n          .remove();\n\n        var nodeEnter = node.enter()\n          .append(\"svg:g\")\n            .attr(\"class\", function(d) { return d.children ? \"node parent node_\" + d.id : \"node child node_\" + d.id; })\n            .attr(\"transform\", function(d,i) { return  \"rotate(\" + (source.x - 90) + \")translate(\" + (source.y ) + \")\"; });\n        \n\n        var nodeEnterCircle = nodeEnter.append(\"svg:circle\")\n          .attr(\"r\", 4,5)\n          .attr(\"class\", function(d) { return d._children ? \"children\" : \"\"; })\n          .on(\"mousedown\", this.toggleNode.bind(this) );\n\n        var nodeEnterLabel = nodeEnter.append(\"svg:text\")\n          .attr(\"dx\", function(d) { return d.x < 180 ? 8 : -8; })\n          .attr(\"dy\", \".31em\")\n          .attr(\"text-anchor\", function(d) { return d.x < 180 ? \"start\" : \"end\"; })\n          .attr(\"transform\", function(d) { return d.x < 180 ? null : \"rotate(180)\"; })\n          .text(function(d) { return d.name; })\n          .on(\"mousedown\", this.selectNode.bind(this) );\n\n        var nodeUpdate = node.transition()\n          .duration(this.duration)\n          .attr(\"transform\", function(d) { return \"rotate(\" + (d.x - 90) + \")translate(\" + (d.y ) + \")\"; });\n\n        nodeUpdate.select(\"circle\")\n          .attr(\"class\", function(d) { return d._children ? \"children\" : \"\"; });\n        \n\n        var nodeExit = node.exit()\n          .transition()\n            .duration(this.duration)\n            .attr(\"transform\", function(d) { return \"rotate(\" + (source.x - 90) + \")translate(\" + (source.y ) + \")\"; })\n            .remove();\n\n        nodeExit.select(\"circle\")\n          .attr(\"r\", 1e-6);\n\n        nodeExit.select(\"text\")\n          .style(\"fill-opacity\", 1e-6);\n\n        // Stash the old positions for transition.\n        node.forEach(function(d) {\n          d.x0 = d.x;\n          d.y0 = d.y;\n        });\n\n        this.showSelectedNode();\n      }\n    },\n    //open / close a branch of the tree\n    toggleNode: function toggleNodeNav(d, i) {\n      var depth = d.depth;\n      console.log(\"?\", depth);\n      var open = (d._children) ? true : false;\n      //open all nodes\n      function toggleChildren (node){\n        if(((!open && node.depth >= depth) ||(open && node.depth > depth +1) ) && node.children){\n          node._children = node.children;\n          node.children = null;\n        }else if(((open && node.depth <= depth) ) && node._children){\n          node.children = node._children;\n          node._children = null;\n        }\n      }\n      //goes through all children\n      function toggleAllChildren (node){\n        var children = node.children || node._children;\n        if(children){\n          for (var i = 0; i < children.length; i++){\n            toggleChildren(children[i]);\n            toggleAllChildren(children[i]);\n          }\n        }\n      }\n\n      toggleAllChildren(this.root);\n      //\n    \n     this.render(this.root)\n    },\n    \n    //highlight selected concept (listener conceptChanged)\n    showSelectedNode: function showSelectedNodeNav(uri) {\n      d3.select(\".node.selected\").classed(\"selected\", false);\n      var themodel = this.collection.getActiveConcept();\n      if(themodel) d3.select(\".node_\"+ themodel.attributes.id).classed(\"selected\", true);\n    },\n\n    //when a text concept is clicked\n    selectNode: function selectNodeNav(d, i) {\n      //send request to the router\n      application.router.navigate(application.processUri(d.uri), {trigger : true});\n      //backbone being smart enough not to trigger the route if concept already selected\n      //we need to make sure the pop-up is open\n      this.collection.toggleConcept(true);\n      d3.event.stopPropagation();\n    }\n\n});\n","var View = require('./view');\nvar application = require('../application');\nmodule.exports = View.extend({\n\n    // nav listens for changes in the collection.\n    afterInit: function afterInitNav(){\n      this.listenTo(this.collection, 'conceptChanged', this.conceptChanged);\n      this.listenTo(this.collection, 'dataChanged', this.dataChanged);\n      $(window).on(\"resize\", this.resize.bind(this));\n      this.root = this.collection.conceptTree;\n    },\n\n    //init size variables\n    initSize: function initSizeNav() {\n      this.height = $(window).height();\n      this.width = $(window).width() ;\n      this.i = 0;\n      this.duration = 750;\n    },\n\n    //apply size to svg elements\n    setSize: function setSizeNav() {\n      this.initSize();\n\n      this.svg\n        .style(\"width\", this.width + \"px\")\n        .style(\"height\", this.height + \"px\");\n\n      this.vis\n        .attr(\"width\", this.width)\n        .attr(\"height\", this.height);\n    },\n\n\n    dataChanged: function dataChanged() {\n      this.root = this.collection.conceptTree;\n      if(this.root){\n        this.root.x0 = this.height / 2;\n        this.root.y0 = 0;\n        this.preRender();\n      }\n    },\n\n    filterChanged: function filterChanged() {\n      console.log(\"filterChanged\");\n      this.showFilteredNodes();\n    },\n\n    resize: function resizeNav() {\n      this.setSize();\n      this.render(this.root);\n    },\n\n    // Re-renders the titles of the todo item.\n    preRender: function preRenderNav() {\n\n        this.initSize();\n        $(\"nav.nav\").empty();\n        this.tree = d3.layout.tree()\n          .size([this.height, this.width]);\n        //\n        this.diagonal = d3.svg.diagonal()\n          .projection( function(d) { return [d.y, d.x]; } );\n        //\n        this.svg = d3.select(\"nav.nav\");\n        //\n        this.vis = this.svg.append(\"svg:svg\");\n        //\n        this.main = this.vis\n          .append(\"svg:g\")\n            .attr(\"class\", \"main \" + this.collection.getActiveThesaurus().named_id);\n\n        this.setSize();\n\n        if(this.root) this.render(this.root);\n\n    },\n    //render the nav\n    render : function renderNav(source) {\n\n      if(source !== undefined){\n\n      // Compute the new tree layout.\n      var nodes = this.tree.nodes(this.root).reverse(),\n          links = this.tree.links(nodes);\n\n      // Normalize for fixed-depth.\n      nodes.forEach(function(d) { d.y = d.depth * 180; });\n\n      // Update the nodes…\n      var node = this.main.selectAll(\"g.node\")\n          .data(nodes, function(d) { return d.id || (d.id = ++this.i); });\n\n      // Enter any new nodes at the parent's previous position.\n      var nodeEnter = node.enter().append(\"g\")\n          .attr(\"class\", function(d){ return d.filtered ? \"node node_\"+d.id+\" filtered\": \"node node_\"+d.id; })\n          .attr(\"transform\", function(d) { return \"translate(\" + source.y0 + \",\" + source.x0 + \")\"; })\n          .on(\"click\", function(d) { this.selectNode(d); }.bind(this)); //d3.selectAll(\".node\").classed(\"selected\", false); d3.select(\".node_\" + d.id).classed(\"selected\", true);\n\n\n      nodeEnter.append(\"circle\")\n          .attr(\"r\", 1e-6)\n          .attr(\"class\", function(d) { return d._children ? \"children\" : \"\"; });\n          //.on(\"click\", this.toggleNode.bind(this));\n\n      nodeEnter.append(\"text\")\n          .attr(\"x\", function(d) { return d.children || d._children ? -10 : 10; })\n          .attr(\"dy\", \".35em\")\n          .attr(\"text-anchor\", function(d) { return d.children || d._children ? \"end\" : \"start\"; })\n          .text(function(d) { return d.name; })\n          .style(\"fill-opacity\", 1e-6)\n\n\n      // Transition nodes to their new position.\n      var nodeUpdate = node.transition()\n          .duration(this.duration)\n          .attr(\"class\", function(d){ //return d.filtered ? \"node node_\"+d.id+\" filtered\": \"node node_\"+d.id;\n            var themodel = this.collection.getActiveConcept();\n            var id = (themodel) ? themodel.attributes.id : null;\n            return (typeof id === \"string\" && id === d.id) ? \"node node_\"+d.id+\" selected\": \"node node_\"+d.id;\n          }.bind(this))\n          .attr(\"transform\", function(d) { return \"translate(\" + d.y + \",\" + d.x + \")\"; });\n\n      nodeUpdate.select(\"circle\")\n          .attr(\"r\", 4.5)\n          .attr(\"class\", function(d) { return d._children ? \"children\" : \"\"; });\n\n      nodeUpdate.select(\"text\")\n          .style(\"fill-opacity\", 1);\n\n      // Transition exiting nodes to the parent's new position.\n      var nodeExit = node.exit().transition()\n          .duration(this.duration)\n          .attr(\"transform\", function(d) { return \"translate(\" + source.y + \",\" + source.x + \")\"; })\n          .remove();\n\n      nodeExit.select(\"circle\")\n          .attr(\"r\", 1e-6);\n\n      nodeExit.select(\"text\")\n          .style(\"fill-opacity\", 1e-6);\n\n      // Update the links…\n      var link = this.main.selectAll(\"path.link\")\n          .data(links, function(d) { return d.target.id; });\n\n      var diagonal = this.diagonal;\n      // Enter any new links at the parent's previous position.\n      link.enter().insert(\"path\", \"g\")\n          .attr(\"class\", \"link\")\n          .attr(\"d\", function(d) {\n            var o = {x: source.x0, y: source.y0};\n            return diagonal({source: o, target: o});\n          });\n\n      // Transition links to their new position.\n      link.transition()\n          .duration(this.duration)\n          .attr(\"d\", diagonal);\n\n      // Transition exiting nodes to the parent's new position.\n      link.exit().transition()\n          .duration(this.duration)\n          .attr(\"d\", function(d) {\n            var o = {x: source.x, y: source.y};\n            return diagonal({source: o, target: o});\n          })\n          .remove();\n\n        // Stash the old positions for transition.\n        nodes.forEach(function(d) {\n          d.x0 = d.x;\n          d.y0 = d.y;\n        });\n\n      }\n    },\n    //open / close a branch of the tree\n    toggleNode: function toggleNodeNav(d) {\n      //console.log(d);\n      //open all nodes\n      function toggleChildren (node, open){\n        //console.log(node,open)\n        if(!open && node.children){\n          node._children = node.children;\n          node.children = null;\n        }else if(open && node._children){\n          node.children = node._children;\n          node._children = null;\n        }\n      }\n      //open all children\n      function openAllChildren (node){\n        var children = node.children || node._children;\n        if(children){\n          for (var i = 0; i < children.length; i++){\n            //console.log(\"element\",node.children[i]);\n            toggleChildren(children[i], true);\n            openAllChildren(children[i]);\n          }\n        }\n      }\n      openAllChildren(this.root);\n      //\n      function closeSiblings(node){\n        if (!node.parent) return;\n        var siblings = node.parent.children;\n        for (var i = 0; i < siblings.length; i++){\n          if(siblings[i].uri !== node.uri){\n            toggleChildren(siblings[i], false);\n          }\n        }\n        closeSiblings(node.parent);\n      }\n      closeSiblings(d);\n      this.render(this.root);\n    },\n    //\n    findNode: function findNodeNav(node, uri) {\n      var children = node.children || node._children;\n      //console.log(\"enfants\", children, uri)\n      var that = this;\n      var nodeFound;\n      if(children){\n        children.forEach(function(element){\n          if(element.uri === uri) {\n            nodeFound = element;\n          }\n          if(!nodeFound) nodeFound = that.findNode(element, uri);\n        })\n        return nodeFound;\n      }\n    },\n     //highlight selected concept (listener conceptChanged)\n    conceptChanged: function conceptChangedNav() {\n\n      var themodel = this.collection.getActiveConcept();\n      var id = (themodel) ? themodel.attributes.id : null;\n\n      if(typeof id === \"string\") {\n        var alreadySelected = d3.select(\".node.node_\" + id + \".selected\");\n        if(! alreadySelected[0][0] && d3.select(\".node\")[0][0]) {\n          d3.selectAll(\".node.selected\").classed(\"selected\", false);\n          d3.select(\".node_\" + id).classed(\"selected\", true);\n          this.toggleNode(this.findNode(this.root, themodel.attributes.uri));\n        }\n      }\n    },\n\n    //when a text concept is clicked\n    selectNode: function selectNodeNav(d, i) {\n      //send request to the router\n      application.router.navigate(application.processUri(d.uri), {trigger : true});\n\n      //backbone being smart enough not to trigger the route if concept already selected\n      //we need to make sure the pop-up is open\n      this.collection.toggleConcept(true);\n\n      d3.event.stopPropagation();\n    }\n\n});\n","var View = require('./view');\nvar application = require('../application');\nmodule.exports = View.extend({\n    \n    template : require('./templates/selectNav.hbs'),\n    // The DOM events specific to a concept.\n    events: {\n      'change #selectNav': 'selectNav',\n      'change #selectThesaurus': 'selectThesaurus',\n      'change #search': 'search',\n    },\n    //\n    afterInit: function afterInitSelectNav(){\n      this.listenTo(this.collection, 'dataChanged', this.render);\n      this.listenTo(this.collection, 'viewTypeChanged', this.render);\n    },\n    //\n    getRenderData: function getRenderDataSelectNav(){\n      return{\n        viewTypes : this.collection.getViewTypes(),\n        thesauri : this.collection.getThesauri()\n      };\n    },\n    //  \n    selectNav: function selectNav(event) {      \n      this.collection.setViewType(Number($(event.target).val()));\n    },\n    search: function selectNav(event) {\n      this.collection.filter($(event.target).val());\n    },\n    //  \n    selectThesaurus: function selectThesaurus(event) {      \n      //this.collection.setActiveThesaurus($(event.target).val());\n      //this.collection.loadThesaurus();\n      var uri = this.collection.getThesaurusWithNamedId($(event.target).val()).id;\n      application.router.navigate(application.processUri(uri), {trigger : true});\n    }\n\n});","var __templateData = Handlebars.template({\"1\":function(depth0,helpers,partials,data) {\n  return \"    <nav>\\n      <a class=\\\"prev\\\" href=\\\"/\\\"><</a>\\n      <a class=\\\"next\\\" href=\\\"/\\\">></a>\\n    </nav>\\n\";\n  },\"3\":function(depth0,helpers,partials,data) {\n  var stack1, helperMissing=helpers.helperMissing, buffer = \"        <h1>\";\n  stack1 = ((helpers.label_with_language || (depth0 && depth0.label_with_language) || helperMissing).call(depth0, (depth0 != null ? depth0.prefLabel : depth0), (depth0 != null ? depth0.language : depth0), {\"name\":\"label_with_language\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</h1>\\n\";\n},\"5\":function(depth0,helpers,partials,data) {\n  var stack1, helperMissing=helpers.helperMissing, buffer = \"        <h2><code>skos:definition</code></h2>\\n        <p class=\\\"definition\\\">\";\n  stack1 = ((helpers.translation_label || (depth0 && depth0.translation_label) || helperMissing).call(depth0, (depth0 != null ? depth0.conceptDefinition : depth0), {\"name\":\"translation_label\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</p>\\n\";\n},\"7\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"\";\n  stack1 = helpers['if'].call(depth0, \"prefLabel && concept\", {\"name\":\"if\",\"hash\":{},\"fn\":this.program(8, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer;\n},\"8\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:prefLabel</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.prefLabel : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(9, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"9\":function(depth0,helpers,partials,data) {\n  var stack1, helperMissing=helpers.helperMissing, buffer = \"          <li>\";\n  stack1 = ((helpers.translation_label || (depth0 && depth0.translation_label) || helperMissing).call(depth0, depth0, {\"name\":\"translation_label\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \" (\";\n  stack1 = ((helpers.translation_language || (depth0 && depth0.translation_language) || helperMissing).call(depth0, depth0, {\"name\":\"translation_language\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \")</li>\\n\";\n},\"11\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:altLabel</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.altLabel : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(9, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"13\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:hasTopConcept</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.hasTopConcept : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(14, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"14\":function(depth0,helpers,partials,data) {\n  var stack1, lambda=this.lambda, buffer = \"            <li><a href=\\\"\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\" class=\\\"link\\\">\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</a></li>\\n\";\n},\"16\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:broader</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.parents : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(17, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"17\":function(depth0,helpers,partials,data) {\n  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, buffer = \"            <li class=\\\"parent_\"\n    + escapeExpression(lambda((data && data.index), depth0))\n    + \"\\\"><a href=\\\"\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\" class=\\\"link\\\">\";\n  stack1 = ((helpers.name_with_uri || (depth0 && depth0.name_with_uri) || helperMissing).call(depth0, depth0, {\"name\":\"name_with_uri\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</a></li>\\n\";\n},\"19\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:narrower</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.narrower : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(20, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"20\":function(depth0,helpers,partials,data) {\n  var stack1, lambda=this.lambda, helperMissing=helpers.helperMissing, buffer = \"          <li><a href=\\\"\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\" class=\\\"link\\\">\";\n  stack1 = ((helpers.name_with_uri || (depth0 && depth0.name_with_uri) || helperMissing).call(depth0, depth0, {\"name\":\"name_with_uri\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</a></li>\\n\";\n},\"22\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:exactMatch</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.exactMatch : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(23, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"23\":function(depth0,helpers,partials,data) {\n  var stack1, lambda=this.lambda, helperMissing=helpers.helperMissing, buffer = \"        \t<li><a href=\\\"\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\" \";\n  stack1 = ((helpers.is_internal_link || (depth0 && depth0.is_internal_link) || helperMissing).call(depth0, depth0, {\"name\":\"is_internal_link\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \">\";\n  stack1 = ((helpers.name_with_uri || (depth0 && depth0.name_with_uri) || helperMissing).call(depth0, depth0, {\"name\":\"name_with_uri\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</a></li>\\n\";\n},\"25\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"        <h2><code>skos:closeMatch</code></h2>\\n        <ul>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.closeMatch : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(26, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"        </ul>\\n\";\n},\"26\":function(depth0,helpers,partials,data) {\n  var stack1, lambda=this.lambda, helperMissing=helpers.helperMissing, buffer = \"        \t<li><a href=\\\"\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\" \";\n  stack1 = ((helpers.is_internal_link || (depth0 && depth0.is_internal_link) || helperMissing).call(depth0, depth0, {\"name\":\"is_internal_link\",\"hash\":{},\"data\":data}));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \">\";\n  stack1 = lambda(depth0, depth0);\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"</a></li>\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var stack1, helper, functionType=\"function\", helperMissing=helpers.helperMissing, buffer = \"<div class=\\\"concept \";\n  stack1 = ((helper = (helper = helpers.foldedClass || (depth0 != null ? depth0.foldedClass : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"foldedClass\",\"hash\":{},\"data\":data}) : helper));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\">\\n  <header class=\\\"\";\n  stack1 = ((helper = (helper = helpers.conceptSchemeClass || (depth0 != null ? depth0.conceptSchemeClass : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"conceptSchemeClass\",\"hash\":{},\"data\":data}) : helper));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\">\\n    <a class=\\\"close\\\" href=\\\"/\\\">X</a>\\n    <p class=\\\"context\\\"><!--<a href=\\\"\";\n  stack1 = ((helper = (helper = helpers.conceptScheme || (depth0 != null ? depth0.conceptScheme : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"conceptScheme\",\"hash\":{},\"data\":data}) : helper));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\\\" class=\\\"link\\\">--><span>ConceptScheme : \";\n  stack1 = ((helper = (helper = helpers.conceptScheme || (depth0 != null ? depth0.conceptScheme : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"conceptScheme\",\"hash\":{},\"data\":data}) : helper));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"</span><!--</a>--></p>\\n  </header>\\n  <div class=\\\"body\\\">\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.concept : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(1, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"    <hgroup>\\n      <code>\";\n  stack1 = ((helper = (helper = helpers.type || (depth0 != null ? depth0.type : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"type\",\"hash\":{},\"data\":data}) : helper));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"</code>\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.prefLabel : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(3, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"      <p>\";\n  stack1 = ((helper = (helper = helpers.uri || (depth0 != null ? depth0.uri : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"uri\",\"hash\":{},\"data\":data}) : helper));\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"</p>\\n\\n    </hgroup>\\n    <detail>\\n\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.conceptDefinition : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(5, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.concept : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(7, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.altLabel : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(11, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.hasTopConcept : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(13, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.parents : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(16, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.narrower : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(19, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.exactMatch : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(22, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.closeMatch : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(25, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"\\n    </detail>\\n  </div>\\n</div>\\n\";\n},\"useData\":true});\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  return \"<ul>\\n\t<li><a href=\\\"http://www.philharmoniedeparis.fr\\\" target=\\\"_blank\\\"><img src=\\\"images/logos/philharmonie.png\\\" alt=\\\"Philharmonie de Paris\\\" /></a></li>\\n\t<li><a href=\\\"http://www.ed.ac.uk\\\" target=\\\"_blank\\\"><img src=\\\"images/logos/edinburgh.png\\\" alt=\\\"The University of Edinburgh\\\" /></a></li>\\n\t<li><a href=\\\"http://www.gnm.de\\\" target=\\\"_blank\\\"><img src=\\\"images/logos/gnm.png\\\" alt=\\\"Germanisches National Museum\\\" /></a></li>\\n\t<li><a href=\\\"http://www.mim.be\\\" target=\\\"_blank\\\"><img src=\\\"images/logos/mim.png\\\" alt=\\\"Musik Instrumenten Museum\\\" /></a></li>\\n\t<li><a href=\\\"http://network.icom.museum/cimcim/\\\" target=\\\"_blank\\\"><img src=\\\"images/logos/icom.png\\\" alt=\\\"International Council of Museums\\\" /></a></li>\\n</ul>\";\n  },\"useData\":true});\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  return \"<a href=\\\"/\\\"><img src=\\\"/images/logos/mimo.png\\\" alt=\\\"MIMO - Musical Instruments Museums Online\\\" /></a>\\n<!--VIZKOS-->\\n\";\n  },\"useData\":true});\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var Handlebars = require(\"hbsfy/runtime\");\nvar application = require(\"../../application\");\n\nHandlebars.registerHelper('label_with_language', function(labels, language) {\n\t//if a language is specified\n\n\tif(language) {\n\t\tvar filteredLabels = labels.filter(function(element){\n\t\t\treturn element[\"@language\"] === language;\n\t\t})\n\t\tif(filteredLabels[0]) return filteredLabels[0][\"@value\"];\n\t}\n\n\t//otherwise get \"pivot\" element, the only one which is a string\n\n\tvar filteredLabels = labels.filter(function(element){\n\t\treturn typeof element === \"string\";\n\t})\n\treturn filteredLabels[0];\n\n});\n\nHandlebars.registerHelper('translation_language', function(labelObject) {\n\tif (!labelObject) return;\n\t//specific to MIMO thesaurus, pivot language has no language attribute\n\t//(it's a convention, not a real language)\n\tif (typeof labelObject  === \"string\") return \"pivot\";\n\treturn labelObject[\"@language\"];\n});\n\nHandlebars.registerHelper('translation_label', function(labelObject) {\n\tif (!labelObject) return;\n\t//specific to MIMO thesaurus, pivot language has no language attribute\n\t//(it's a convention, not a real language)\n\tif (typeof labelObject  === \"string\") return labelObject;\n\treturn labelObject[\"@value\"];\n});\n\nHandlebars.registerHelper('properties_list', function(property) {\n  \tif(Array.isArray(property)) return property;\n  \treturn [property];\n});\n\nHandlebars.registerHelper('process_uri', function(uri) {\n\tif(!uri) return;\n\treturn application.processUri(uri);\n});\n\nHandlebars.registerHelper('name_with_uri', function(uri) {\n\tif (!uri) return;\n\treturn application.collection.getNameWithUri(uri);\n});\n\nHandlebars.registerHelper('is_internal_link', function(uri) {\n\tif(!uri) return;\n  \tif(application.collection.matchAnyThesaurus(uri)){\n  \t\treturn \" class='link'\";\n  \t}else{\n  \t\treturn \" target='_blank'\";\n  \t}\n});\n","var __templateData = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  return \"<div class=\\\"home\\\" style=\\\"background:url('images/international1.jpg') left top no-repeat fixed;\\\">\\n\t<div class=\\\"box international\\\">\\n\t\t<a href=\\\"http://www.mimo-international.com/MIMO/\\\" style=\\\"background: url('images/international1.jpg') left top no-repeat fixed; \\\">\\n\t\t\t<div class=\\\"text\\\">\\n\t\t\t\t<h2>Museum collections</h2>\\n\t\t\t\t<p><span>Explore the world collections of musical instruments.</span></p>\\n\t\t\t</div>\\n\t\t</a>\\n\t</div>\\n\t<div class=\\\"box thesaurus\\\">\\n\t\t<a href=\\\"InstrumentsKeywords/\\\" style=\\\"background:url('images/vizskos.png')  left top no-repeat fixed;\\\">\\n\t\t\t<div class=\\\"text\\\">\\n\t\t\t\t<h2>Vocabulary</h2>\\n\t\t\t\t<p><span>Browse MIMO thesaurus and Hornbostel &amp; Sachs Classification using VIZSKOS, a SKOS data visualization tool.</span></p>\\n\t\t\t</div>\\n\t\t</a>\\n\t</div>\\n\t<div class=\\\"box admin\\\">\\n\t\t<a href=\\\"http://www.mimo-db.eu/mimo/infodoc/page-daccueil-infodoc.aspx?_lg=EN-en\\\" style=\\\"background:url('images/international3.jpg') left top no-repeat fixed; \\\">\\n\t\t\t<div class=\\\"text\\\">\\n\t\t\t\t<h2>Database</h2>\\n\t\t\t\t<p><span>Use MIMO-DB backoffice to administrate your collection and perform advanced search.</span></p>\\n\t\t\t</div>\\n\t\t</a>\\n\t</div>\\n\\n</div>\";\n  },\"useData\":true});\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template({\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  return \"<main class=\\\"main\\\">\\n  <header>\\n  \t<div class=\\\"logo\\\"></div>\\n  \t<nav class=\\\"tools\\\"></nav>\\n  </header>\\n  \\n  <nav class=\\\"nav\\\">\\n    \\n  </nav>\\n  <article></article>\\n</main>\\n<footer></footer>\";\n  },\"useData\":true});\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template({\"1\":function(depth0,helpers,partials,data) {\n  var stack1, helper, functionType=\"function\", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = \"  \t\t<option value=\\\"\"\n    + escapeExpression(((helper = (helper = helpers.named_id || (depth0 != null ? depth0.named_id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"named_id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.selected : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(2, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \" >\"\n    + escapeExpression(((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"name\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</option>\\n\";\n},\"2\":function(depth0,helpers,partials,data) {\n  return \" selected=\\\"selected\\\" \";\n  },\"4\":function(depth0,helpers,partials,data) {\n  var stack1, helper, functionType=\"function\", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = \"  \t\t<option value=\\\"\"\n    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.selected : depth0), {\"name\":\"if\",\"hash\":{},\"fn\":this.program(2, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \" >\"\n    + escapeExpression(((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {\"name\":\"name\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</option>\\n\";\n},\"compiler\":[6,\">= 2.0.0-beta.1\"],\"main\":function(depth0,helpers,partials,data) {\n  var stack1, buffer = \"<form>\\n\t<select id=\\\"selectThesaurus\\\" name=\\\"selectThesaurus\\\">\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.thesauri : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(1, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  buffer += \"\t</select><br />\\n\t<select id=\\\"selectNav\\\" name=\\\"selectNav\\\">\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.viewTypes : depth0), {\"name\":\"each\",\"hash\":{},\"fn\":this.program(4, data),\"inverse\":this.noop,\"data\":data});\n  if (stack1 != null) { buffer += stack1; }\n  return buffer + \"\t</select>\\n</form>\\n<!--<br />\\n\t<input name=\\\"search\\\" id=\\\"search\\\" placeholder=\\\"Rechercher\\\" />-->\\n\";\n},\"useData\":true});\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var _ = require('underscore');\nvar helpers = require('./templates/helpers');\n\nmodule.exports = Backbone.View.extend({\n  initialize: function initializeView() {\n    _.bindAll(this, 'template', 'getRenderData', 'render', 'afterRender');\n    this.afterInit();\n  },\n  afterInit: function afterInitView() {},\n  template: function templateView() {},\n  getRenderData: function getRenderDataView() {},\n\n  render: function renderView() {\n    this.$el.empty();\n    this.$el.html(this.template(this.getRenderData()));\n    _.defer(this.afterRender); //setTimeOut(0)\n  },\n\n  afterRender: function afterRenderView() {}\n});"]}